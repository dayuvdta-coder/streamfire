<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - Streamingku</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f0f9ff;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #fff;
            border-left: 2px solid #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #000;
            border: 2px solid #fff;
        }
    </style>
</head>

<body class="text-black antialiased selection:bg-cyan-400 selection:text-black">

    <%- include('partials/header', { path: '/gallery' }) %>

        <div class="md:ml-64 min-h-screen flex flex-col">

            <header
                class="h-16 border-b-2 border-black bg-pink-400 sticky top-0 z-30 flex items-center px-4 md:px-8 shadow-sm">
                <h1
                    class="text-xl font-black text-black italic bg-white border-2 border-black px-3 py-1 shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] uppercase">
                    <%= t.media_gallery %>
                </h1>
            </header>

            <main class="flex-1 p-4 md:p-8">

                <% if (!videos || videos.length===0) { %>
                    <div
                        class="flex flex-col items-center justify-center h-96 text-center border-4 border-black border-dashed bg-white">
                        <div
                            class="w-20 h-20 bg-yellow-400 border-2 border-black flex items-center justify-center mb-4 text-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
                            <i class="fas fa-images text-3xl"></i>
                        </div>
                        <h3 class="text-2xl font-black text-black uppercase">
                            <%= t.no_videos_found %>
                        </h3>
                        <p
                            class="text-black font-bold text-sm mt-1 bg-cyan-200 inline-block px-2 border-2 border-black">
                            <%= t.uploaded_videos_appear_here %>
                        </p>
                    </div>
                    <% } else { %>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                            <% videos.forEach(video=> { %>
                                <% if (video.filename) { %>
                                    <div
                                        class="bg-white border-2 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] group cursor-pointer relative hover:translate-x-[3px] hover:translate-y-[3px] hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] transition-all">
                                        <div class="aspect-video relative border-b-2 border-black">
                                            <video
                                                class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
                                                preload="metadata">
                                                <% if (video.filename) { %>
                                                    <source src="/uploads/<%= video.filename %>#t=1.0" type="video/mp4">
                                                    <% } %>
                                            </video>
                                            <div
                                                class="absolute bottom-2 right-2 bg-black text-white border border-white px-1.5 py-0.5 text-[10px] font-bold">
                                                MP4
                                            </div>
                                        </div>
                                        <div class="p-3 bg-white">
                                            <h4 class="text-sm font-black text-black truncate uppercase"
                                                title="<%= video.title %>">
                                                <%= video.title %>
                                            </h4>
                                            <div
                                                class="text-[10px] text-gray-800 font-bold mt-2 flex items-center justify-between">
                                                <span class="bg-gray-200 px-1 border border-black">
                                                    <%= new Date().toLocaleDateString() %>
                                                </span>
                                                <div class="flex gap-2">
                                                    <button onclick="playVideo('/uploads/<%= video.filename %>')"
                                                        class="text-pink-600 hover:text-pink-800"><i
                                                            class="fas fa-play-circle mr-1"></i>
                                                        <%= t.preview %>
                                                    </button>
                                                    <button onclick="deleteVideo('<%= video.id %>')"
                                                        class="text-red-500 hover:text-red-700">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% }) %>
                        </div>
                        <% } %>

            </main>
        </div>

        <div id="videoModal" class="fixed inset-0 bg-black/90 z-[70] hidden flex items-center justify-center p-4">
            <div
                class="bg-black border-2 border-white w-full max-w-4xl relative shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                <button onclick="closeVideoModal()"
                    class="absolute -top-10 right-0 text-white text-xl hover:text-red-500 font-bold uppercase tracking-widest">CLOSE
                    [X]</button>
                <video id="modalVideo" controls class="w-full h-auto aspect-video"></video>
            </div>
        </div>

        <script>
            function playVideo(src) {
                const modal = document.getElementById('videoModal');
                const video = document.getElementById('modalVideo');
                video.src = src;
                modal.classList.remove('hidden');
                video.play();
            }

            function closeVideoModal() {
                const modal = document.getElementById('videoModal');
                const video = document.getElementById('modalVideo');
                video.pause();
                video.src = '';
                modal.classList.add('hidden');
            }

            async function deleteVideo(id) {
                const result = await Swal.fire({
                    title: 'Delete Video?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#374151',
                    confirmButtonText: 'Delete',
                    background: '#1f2937', color: '#fff'
                });
                if (result.isConfirmed) {
                    await fetch('/api/video/' + id, { method: 'DELETE' });
                    window.location.reload();
                }
            }
        </script>

</body>

</html>
